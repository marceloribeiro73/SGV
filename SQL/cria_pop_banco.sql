/*
** Script de criação e população das tabelas do sistema com dados ficticios
*/

--USE MASTER

--DROP DATABASE SGV_DEV

--CREATE DATABASE SGV_DEV

--USE SGV_DEV

CREATE TABLE TIPO_USUARIO(
    COD_TIPO_USUARIO INT PRIMARY KEY IDENTITY(1,1),
    NOME_TIPO_USUARIO VARCHAR(64) UNIQUE NOT NULL,
    STATUS CHAR NOT NULL,
    DATA_CRIACAO DATETIME NOT NULL,
    DATA_INATIVCAO DATETIME
)

INSERT INTO TIPO_USUARIO VALUES ('Administrador','A',getdate(),null)
INSERT INTO TIPO_USUARIO VALUES ('Usuario Padrão', 'A', getdate(), null)
INSERT INTO TIPO_USUARIO VALUES ('Usuario Somente Leitura', 'A', getdate(), null)

SELECT 'TIPO_USUARIO CRIADA'

CREATE TABLE TIPO_EVENTO(
    COD_TIPO_EVENTO INT PRIMARY KEY IDENTITY(1,1),
    NOME_TIPO_EVENTO VARCHAR(64) UNIQUE NOT NULL,
    DESCRICAO VARCHAR(128) NOT NULL,
    DATA_CRIACAO DATETIME NOT NULL,
    DATA_INATIVACAO DATETIME
)

INSERT INTO TIPO_EVENTO VALUES ('EXTERNO','EVENTOS REALIZADOS FORA DA SEDE DA ONG', getdate(),null)
INSERT INTO TIPO_EVENTO VALUES ('INTERNO', 'EVENTOS REALIZADOS NA SEDE DA ONG', getdate(), null)

SELECT 'TIPO_EVENTO CRIADA'

CREATE TABLE TIPO_VOLUNTARIO(
    COD_TIPO_VOLUNTARIO INT PRIMARY KEY IDENTITY(1,1),
    NOME_TIPO_VOLUNTARIO VARCHAR(64) NOT NULL
)

INSERT INTO TIPO_VOLUNTARIO VALUES ('GESTÃO')
INSERT INTO TIPO_VOLUNTARIO VALUES ('INTERNO')
INSERT INTO TIPO_VOLUNTARIO VALUES ('EXTERNO')

SELECT 'TIPO_VOLUNTARIO CRIADA'

CREATE TABLE VOLUNTARIO(
    CPF VARCHAR(11) PRIMARY KEY,
    PRIMEIRO_NOME VARCHAR(64) NOT NULL,
    ULTIMO_NOME VARCHAR(64) NOT NULL,
    DATA_NASC DATE NOT NULL,
    DOC_IDENTIFICACAO VARCHAR(32) NOT NULL,
    TIPO_DOC_IDENTIFICACAO CHAR NOT NULL,
    DATA_EMISSAO DATE NOT NULL,
    ORGAO_EMISSOR VARCHAR(64) NOT NULL,
    NACIONALIDADE VARCHAR(64) NOT NULL,
    TELEFONE_CONTATO VARCHAR(64) NOT NULL,
    TELEFONE_CONTATO2 VARCHAR(64),
    EMAIL VARCHAR(128) NOT NULL,
    DATA_ADESAO DATE NOT NULL,
    PATH_FOTO VARCHAR(256),
    DATA_CRIACAO DATETIME NOT NULL,
    STATUS CHAR NOT NULL,
    MAX_HORAS_SEMANAIS INT NOT NULL,
    TIPO_VOLUNTARIO INT,
    FOREIGN KEY(TIPO_VOLUNTARIO) REFERENCES TIPO_VOLUNTARIO(COD_TIPO_VOLUNTARIO)
)
INSERT INTO VOLUNTARIO VALUES ('20132467801','João', 'Da Silva','1985-09-21','323459871','R','2011-06-04','SSP-SP','Brasileira','11967564321',null,'joaosilva89@zipmail.com','2010-10-02',null,getdate(),'A',8,1)
INSERT INTO VOLUNTARIO VALUES ('34567523491', 'Paula', 'Farias','1991-07-05','315674561','R','2011-06-03','SSP-SP','Brasileira','11998564371','11987654439','paula.mfarias@ibest.com.br','2011-01-23',null,getdate(),'A',6,2)
INSERT INTO VOLUNTARIO VALUES ('45678678890','Yara', 'Ribeiro', '1985-09-21', '096756768','R','2010-05-25','SSS-SP','Brasileira','1132456544','11978654433','yara85ribeiro@bol.com.br','2011-10-23', null,getdate(),'A',7,2)

SELECT 'VOLUTARIO CRIADA'

CREATE TABLE DIAS_SEMANA(
    COD_DIA INT PRIMARY KEY,
    DIA_SEMANA VARCHAR(64) UNIQUE NOT NULL
)
SELECT 'DIAS_SEMANA CRIADA'

CREATE TABLE DIAS_SEMANA_VOLUNTARIO(
    VOLUNTARIO VARCHAR(11),
    DIA_SEMANA INT,
    FOREIGN KEY(VOLUNTARIO) REFERENCES VOLUNTARIO(CPF),
    FOREIGN KEY(DIA_SEMANA) REFERENCES DIAS_SEMANA(COD_DIA)
)

SELECT 'DIAS_SEMANA_VOLUNTARIO CRIADA'

INSERT INTO DIAS_SEMANA VALUES (1, 'DOMINGO')
INSERT INTO DIAS_SEMANA VALUES (2, 'SEGUNDA')
INSERT INTO DIAS_SEMANA VALUES (3, 'TERÇA')
INSERT INTO DIAS_SEMANA VALUES (4, 'QUARTA')
INSERT INTO DIAS_SEMANA VALUES (5, 'QUINTA')
INSERT INTO DIAS_SEMANA VALUES (6, 'SEXTA')
INSERT INTO DIAS_SEMANA VALUES (7, 'SABADO')



INSERT INTO DIAS_SEMANA_VOLUNTARIO VALUES ('20132467801',1)
INSERT INTO DIAS_SEMANA_VOLUNTARIO VALUES ('20132467801',2)
INSERT INTO DIAS_SEMANA_VOLUNTARIO VALUES ('20132467801',3)
INSERT INTO DIAS_SEMANA_VOLUNTARIO VALUES ('20132467801',5)
INSERT INTO DIAS_SEMANA_VOLUNTARIO VALUES ('20132467801',6)
INSERT INTO DIAS_SEMANA_VOLUNTARIO VALUES ('20132467801',7)

INSERT INTO DIAS_SEMANA_VOLUNTARIO VALUES ('34567523491',1)
INSERT INTO DIAS_SEMANA_VOLUNTARIO VALUES ('34567523491',7)

INSERT INTO DIAS_SEMANA_VOLUNTARIO VALUES ('45678678890',1)
INSERT INTO DIAS_SEMANA_VOLUNTARIO VALUES ('45678678890',4)
INSERT INTO DIAS_SEMANA_VOLUNTARIO VALUES ('45678678890',7)

SELECT 'TERMO_ADSAO CRIADA'

CREATE TABLE TERMO_ADSAO(
    VOLUNTARIO VARCHAR(11),
    PATH_TERMO VARCHAR(256),
    STATUS CHAR NOT NULL,
    FOREIGN KEY(VOLUNTARIO) REFERENCES VOLUNTARIO(CPF)
) 
--SELECT COUNT(V.CPF) AS 'PENDENCIAS' FROM VOLUNTARIO V, TERMO_ADSAO TA WHERE V.CPF =  TA.VOUNTARIO AND  TA.PATH_ADESAO = NULL OR V.CPF   NOT IN (SELECT V.CPF FROM VOLUNTARIO V, TERMO_ADSAO TA WHERE V.CPF = TA.VOLUNTARIO)

--SELECT COUNT(V.CPF) AS 'PENDENCIAS' FROM VOLUNTARIO V, EVENTO E, VOLUNTARIO_x_EVENTO VE WHERE V.CPF = VE.VOLUNTARIO AND E.COD_EVENTO = VE.EVENTO AND V.STATUS = 'P' AND V.CPF =  

SELECT 'ENDERECO CRIADA'

CREATE TABLE ENDERECO(
    CPF VARCHAR(11),
    COD_POSTAL VARCHAR(64),
    LOGRADOURO VARCHAR(128),
    NUMERO VARCHAR(12),
    COMPLEMENTO VARCHAR(12),
    BAIRRO VARCHAR(128),
    CIDADE VARCHAR(128),
    ESTADO_PROVINCIA VARCHAR(128),
    PAIS VARCHAR(128),
    FOREIGN KEY(CPF) REFERENCES VOLUNTARIO(CPF)
)
SELECT 'EVENTO CRIADA'

INSERT INTO ENDERECO VALUES ('20132467801','02434031', 'Rua dos Simões', '13', null,'Santa Monica','Aruja','São Paulo','Brasil')
INSERT INTO ENDERECO VALUES ('34567523491', '12334786', 'Avenida Agua de Haia', '13442', 'Fundos', 'Itaquera', 'São Paulo', 'São Paulo', 'Brasil')
INSERT INTO ENDERECO VALUES ('45678678890','12334566', 'Rua Cordoba', '234', 'Apto 12', 'Itaquera', 'São Paulo', 'São Paulo', 'Brasil')

UPDATE ENDERECO SET COD_POSTAL = '02325090' WHERE CPF = '34567523491'

CREATE TABLE EVENTO(
  COD_EVENTO INT PRIMARY KEY IDENTITY(1,1),
  NOME_EVENTO VARCHAR(64) UNIQUE NOT NULL,
  DATA_INICIO DATE NOT NULL,
  DATA_FIM DATE NOT NULL,
  ENDERECO VARCHAR(256),
  STATUS CHAR NOT NULL,
  DATA_CRIACAO DATETIME NOT NULL,
  DATA_INATIVACAO DATETIME,
  TIPO_EVENTO INT,
  FOREIGN KEY(TIPO_EVENTO) REFERENCES TIPO_EVENTO(COD_TIPO_EVENTO)
)

INSERT INTO EVENTO VALUES ('Entrega do Dia 12/05', '2017-05-12', '2017-05-12', 'Praça da Republica', 'A', getdate(),null,'1')
INSERT INTO EVENTO VALUES ('Assembleia geral - Janeiro/18','2018-01-16','2018-01-16', 'Sede da Ong','A',getdate(),NULL,2)

SELECT 'ATIVIDADE CRIADA'

CREATE TABLE ATIVIDADE(
    COD_ATIVIDADE INT PRIMARY KEY IDENTITY(1,1),
    NOME_ATIVIDADE VARCHAR(64) NOT NULL UNIQUE,
    QTD_VOLUNTARIOS INT NOT NULL,
    QTD_MINUTOS INT NOT NULL,
    STATUS CHAR NOT NULL,
    DATA_CRIACAO DATETIME NOT NULL
)

INSERT INTO ATIVIDADE VALUES ('ENTREGA PEQUENA DE REFEIÇÕES NOTURNA',15,90,'A',getdate())
INSERT INTO ATIVIDADE VALUES ('ENTREGA MEDIA DE REFEIÇÕES NOTURNA',22,110,'A',getdate())
INSERT INTO ATIVIDADE VALUES ('ENTREGA GRANDE DE REFEIÇÕES NOTURNA',30,180,'A',getdate())

SELECT 'TIPO_VOLUNTARIO_x_ATIVIDADE'

CREATE TABLE TIPO_VOLUNTARIO_x_ATIVIDADE(
    ATIVIDADE INT,
    TIPO_VOLUNTARIO INT,
    FOREIGN KEY(ATIVIDADE) REFERENCES ATIVIDADE(COD_ATIVIDADE),
    FOREIGN KEY(TIPO_VOLUNTARIO) REFERENCES TIPO_VOLUNTARIO(COD_TIPO_VOLUNTARIO)
)

SELECT 'ATIVIDADE_x_EsVENTO'

--SELECT A.COD_ATIVIDADE, A.NOME_ATIVIDADE, A.QTD_VOLUNTARIOS, A.QTD_MINUTOS, A.STATUS FROM ATIVIDADE A, EVENTO E, ATIVIDADE_x_EVENTO AE WHERE A.COD_ATIVIDADE = AE.ATIVIDADE AND E.COD_EVENTO = AE.EVENTO AND A.STATUS <> 'I' AND COD_EVENTO =
 
CREATE TABLE ATIVIDADE_x_EVENTO(
	SEQUENCIAL INT PRIMARY KEY IDENTITY(1,1),
	ATIVIDADE INT,
	EVENTO INT,
    CORDENADOR_ATIVIDADE VARCHAR(11),
	FOREIGN KEY(ATIVIDADE) REFERENCES ATIVIDADE(COD_ATIVIDADE),
	FOREIGN KEY(EVENTO) REFERENCES EVENTO(COD_EVENTO)
)

CREATE TABLE VOLUNTARIO_x_ATIVIDADE_x_EVENTO(
    VOLUNTARIO VARCHAR(11),
    ATIVIDADE_x_EVENTO INT,
    DATA_ATRIBUÇÃO DATETIME NOT NULL,
    STATUS CHAR NOT NULL,
    QUANTIDADE_HORAS_DECLARADA INT,
    DATA_DECLARADA DATE,
    DATA_DECLARACAO DATETIME,
    STATUS_DECLARACAO CHAR,
    DATA_VISTO_COORD DATETIME,
    COMENTARIO_COOD VARCHAR (511)
    FOREIGN KEY(VOLUNTARIO) REFERENCES VOLUNTARIO(CPF),
    FOREIGN KEY(ATIVIDADE_x_EVENTO) REFERENCES ATIVIDADE_x_EVENTO(SEQUENCIAL)
)





SELECT 'USUARIO'

--select * from USUARIO

CREATE TABLE USUARIO(
    COD_USUARIO INT PRIMARY KEY IDENTITY(1,1),
    VOLUNTARIO VARCHAR(11),
    LOGIN_NAME VARCHAR(64) NOT NULL UNIQUE,
    PASSWD VARCHAR(255) NOT NULL,
    TIPO_USUARIO INT,
    STATUS CHAR NOT NULL,
    DATA_CRIACAO DATETIME NOT NULL,
    DATA_INATIVACAO DATETIME,
    QTD_FALHAS_LOGIN INT,
    DATA_BLOQUEIO DATETIME,
    FOREIGN KEY(VOLUNTARIO) REFERENCES VOLUNTARIO(CPF),
    FOREIGN KEY(TIPO_USUARIO) REFERENCES TIPO_USUARIO(COD_TIPO_USUARIO)
)

SELECT 'LOGS_APLICACAO'

INSERT INTO USUARIO VALUES ('20132467801','joaosilva89@zipmail.com','123456',1,'A',GETDATE(),NULL,NULL,NULL)

CREATE TABLE LOGS_APLICACAO(
    SEQUENCIAL_OCORRENCIA INT PRIMARY KEY IDENTITY(1,1),
    USUARIO INT,
    DATA_OCORENCIA DATETIME NOT NULL,
    DESCRICAO_OCORRENCIA VARCHAR(255) NOT NULL
)

SELECT 'STATUS_APP'

CREATE TABLE STATUS_APP(
    SIGLA_STATUS CHAR PRIMARY KEY,
    NOME_STATUS VARCHAR(64) NOT NULL
    
)

INSERT INTO STATUS_APP VALUES ('A','ATIVO');
INSERT INTO STATUS_APP VALUES ('I','INATIVO');
INSERT INTO STATUS_APP VALUES ('B','BLOQUEADO');


SELECT U.COD_USUARIO AS 'CODIGO', V.PRIMEIRO_NOME +" "+ V.ULTIMO_NOME AS 'VOLUNTARIO', U.LOGIN_NAME AS 'USUARIO', U.PASSWD AS 'SEGREDO', TU.NOME_TIPO_USUARIO AS 'TIPO', U.STATUS AS 'STATUS', U.DATA_CRIACAO AS 'DATA DE CRIAÇÃO', U.DATA_INATIVACAO AS 'DATA DE INATIVAÇÃO', U.QTD_FALHAS_LOGIN AS 'FALHAS LOGIN', U.DATA_BLOQUEIO AS 'DATA DE BLOQUEIO' FROM USUARIO U, TIPO_USUARIO TU, VOLUNTARIO V WHERE U.STATUS <> 'I' AND U.TIPO_USUARIO = TU.COD_TIPO_USUARIO
